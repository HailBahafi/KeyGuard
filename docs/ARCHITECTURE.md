# ğŸ—ï¸ Architecture Overview

KeyGuard is a comprehensive device binding platform designed to secure LLM API keys by cryptographically binding them to trusted devices.

---

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 KeyGuard Platform                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚    â”‚   Client App     â”‚                                                         â”‚
â”‚    â”‚  with SDK        â”‚                                                         â”‚
â”‚    â”‚                  â”‚                                                         â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â”‚
â”‚    â”‚  â”‚ KeyGuard   â”‚  â”‚                                                         â”‚
â”‚    â”‚  â”‚ SDK        â”‚  â”‚                                                         â”‚
â”‚    â”‚  â”‚            â”‚  â”‚                                                         â”‚
â”‚    â”‚  â”‚ â€¢ Crypto   â”‚  â”‚                                                         â”‚
â”‚    â”‚  â”‚ â€¢ Storage  â”‚  â”‚                                                         â”‚
â”‚    â”‚  â”‚ â€¢ Signing  â”‚  â”‚                                                         â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚             â”‚                                                                   â”‚
â”‚             â”‚ Signed Requests                                                   â”‚
â”‚             â”‚ (x-keyguard-* headers)                                            â”‚
â”‚             â–¼                                                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚    â”‚                    Backend API                           â”‚                 â”‚
â”‚    â”‚                    (NestJS)                              â”‚                 â”‚
â”‚    â”‚                                                          â”‚                 â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                 â”‚
â”‚    â”‚  â”‚   Auth     â”‚  â”‚  KeyGuard  â”‚  â”‚   Proxy    â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚  Module    â”‚  â”‚  Module    â”‚  â”‚  Module    â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚ â€¢ JWT      â”‚  â”‚ â€¢ Verify   â”‚  â”‚ â€¢ OpenAI   â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚ â€¢ Login    â”‚  â”‚ â€¢ Enroll   â”‚  â”‚ â€¢ Anthropicâ”‚          â”‚                 â”‚
â”‚    â”‚  â”‚ â€¢ Refresh  â”‚  â”‚ â€¢ Validate â”‚  â”‚ â€¢ Google   â”‚          â”‚                 â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                 â”‚
â”‚    â”‚                                                          â”‚                 â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                 â”‚
â”‚    â”‚  â”‚  Devices   â”‚  â”‚  API Keys  â”‚  â”‚   Audit    â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚  Module    â”‚  â”‚  Module    â”‚  â”‚   Module   â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚ â€¢ Enroll   â”‚  â”‚ â€¢ Create   â”‚  â”‚ â€¢ Log      â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚ â€¢ Approve  â”‚  â”‚ â€¢ Rotate   â”‚  â”‚ â€¢ Export   â”‚          â”‚                 â”‚
â”‚    â”‚  â”‚ â€¢ Revoke   â”‚  â”‚ â€¢ Revoke   â”‚  â”‚ â€¢ Filter   â”‚          â”‚                 â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                 â”‚
â”‚    â”‚                                                          â”‚                 â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                             â”‚                                                   â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚             â–¼               â–¼               â–¼                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚    â”‚  PostgreSQL  â”‚ â”‚    Redis     â”‚ â”‚ LLM APIs     â”‚                           â”‚
â”‚    â”‚  Database    â”‚ â”‚   (Cache)    â”‚ â”‚              â”‚                           â”‚
â”‚    â”‚              â”‚ â”‚              â”‚ â”‚ â€¢ OpenAI     â”‚                           â”‚
â”‚    â”‚ â€¢ Users      â”‚ â”‚ â€¢ Sessions   â”‚ â”‚ â€¢ Anthropic  â”‚                           â”‚
â”‚    â”‚ â€¢ Devices    â”‚ â”‚ â€¢ Rate Limit â”‚ â”‚ â€¢ Google     â”‚                           â”‚
â”‚    â”‚ â€¢ API Keys   â”‚ â”‚              â”‚ â”‚ â€¢ Azure      â”‚                           â”‚
â”‚    â”‚ â€¢ Audit Logs â”‚ â”‚              â”‚ â”‚              â”‚                           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚    â”‚                  Frontend Dashboard                      â”‚                 â”‚
â”‚    â”‚                    (Next.js)                             â”‚                 â”‚
â”‚    â”‚                                                          â”‚                 â”‚
â”‚    â”‚  â€¢ Device Management    â€¢ API Key Management             â”‚                 â”‚
â”‚    â”‚  â€¢ Audit Log Viewer     â€¢ Settings & Configuration       â”‚                 â”‚
â”‚    â”‚  â€¢ Security Alerts      â€¢ User Administration            â”‚                 â”‚
â”‚    â”‚                                                          â”‚                 â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Components

### 1. SDK (Client-Side)

The TypeScript SDK runs in client applications:

| Component               | Responsibility                              |
|-------------------------|---------------------------------------------|
| **CryptoManager**       | ECDSA P-256 key generation and signing      |
| **StorageAdapter**      | Secure key storage (IndexedDB/Memory)       |
| **FingerprintProvider** | Device identification                       |
| **KeyGuardClient**      | Main API for enrollment and signing         |
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
**Key Features:**
- Non-extractable private keys (WebCrypto API)
- Automatic request signing
- Device fingerprinting for audit trails

---

### 2. Backend API (Server-Side)

The NestJS backend handles all server-side logic:

| Module           | Responsibility                            |
|------------------|-------------------------------------------|
| **Auth**         | JWT authentication, login, token refresh  |
| **KeyGuard**     | Signature verification, device enrollment |
| **Devices**      | Device inventory management               |
| **API Keys**     | LLM API key storage and management        |
| **Proxy**        | Request proxying to LLM providers         |
| **Audit**        | Activity logging and export               |
| **Settings**     | System configuration                      |
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
**Key Features:**
- Signature verification middleware
- Rate limiting and IP whitelisting
- Comprehensive audit logging

---

### 3. Frontend Dashboard

The Next.js admin dashboard provides:

| Feature                  | Description                              |
|--------------------------|------------------------------------------|
| **Device Management**    | View, approve, suspend, revoke devices   |
| **API Key Management**   | Create, rotate, delete LLM API keys      |
| **Audit Logs**           | View and export activity logs            |
| **Settings**             | Configure security policies              |
| **Internationalization** | English and Arabic (RTL) support         |
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## Data Flow

### Device Enrollment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client   â”‚     â”‚  Backend   â”‚     â”‚  Database  â”‚
â”‚    App     â”‚     â”‚    API     â”‚     â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                  â”‚                  â”‚
      â”‚ 1. Generate      â”‚                  â”‚
      â”‚    Key Pair      â”‚                  â”‚
      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚ 2. Collect       â”‚                  â”‚
      â”‚    Fingerprint   â”‚                  â”‚
      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚ 3. POST /enroll  â”‚                  â”‚
      â”‚   {publicKey,    â”‚                  â”‚
      â”‚    fingerprint,  â”‚                  â”‚
      â”‚    enrollCode}   â”‚                  â”‚
      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                  â”‚                  â”‚
      â”‚                  â”‚ 4. Validate      â”‚
      â”‚                  â”‚    Code          â”‚
      â”‚                  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                  â”‚                  â”‚
      â”‚                  â”‚ 5. Store Device  â”‚
      â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
      â”‚                  â”‚                  â”‚
      â”‚ 6. Return        â”‚                  â”‚
      â”‚    Device ID     â”‚                  â”‚
      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
      â”‚                  â”‚                  â”‚
```

### Request Signing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client   â”‚     â”‚  Backend   â”‚     â”‚  KeyGuard  â”‚     â”‚  LLM API   â”‚
â”‚    App     â”‚     â”‚    API     â”‚     â”‚  Module    â”‚     â”‚ (OpenAI)   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                  â”‚                  â”‚                  â”‚
      â”‚ 1. Sign Request  â”‚                  â”‚                  â”‚
      â”‚    with SDK      â”‚                  â”‚                  â”‚
      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                  â”‚                  â”‚
      â”‚                  â”‚                  â”‚                  â”‚
      â”‚ 2. POST /proxy   â”‚                  â”‚                  â”‚
      â”‚   + x-keyguard-* â”‚                  â”‚                  â”‚
      â”‚     headers      â”‚                  â”‚                  â”‚
      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                  â”‚
      â”‚                  â”‚                  â”‚                  â”‚
      â”‚                  â”‚ 3. Verify        â”‚                  â”‚
      â”‚                  â”‚    Signature     â”‚                  â”‚
      â”‚                  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
      â”‚                  â”‚                  â”‚                  â”‚
      â”‚                  â”‚ 4. Check Device  â”‚                  â”‚
      â”‚                  â”‚    Status        â”‚                  â”‚
      â”‚                  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
      â”‚                  â”‚                  â”‚                  â”‚
      â”‚                  â”‚                  â”‚ 5. Forward       â”‚
      â”‚                  â”‚                  â”‚    Request       â”‚
      â”‚                  â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
      â”‚                  â”‚                  â”‚                  â”‚
      â”‚                  â”‚                  â”‚ 6. LLM Response  â”‚
      â”‚                  â”‚                  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â”‚                  â”‚                  â”‚                  â”‚
      â”‚ 7. Return        â”‚                  â”‚                  â”‚
      â”‚    Response      â”‚                  â”‚                  â”‚
      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â”‚                  â”‚                  â”‚                  â”‚
```

---

## Technology Stack

| Layer           | Technology                           | Purpose                      |
|-----------------|--------------------------------------|------------------------------|
| **SDK**         | TypeScript, WebCrypto, IndexedDB     | Client-side cryptography     |
| **Backend**     | NestJS, Prisma, PostgreSQL           | API and data layer           |
| **Frontend**    | Next.js, React, Tailwind             | Admin dashboard              |
| **Security**    | ECDSA P-256, SHA-256, JWT            | Cryptographic operations     |
| **Caching**     | Redis (optional)                     | Session and rate limiting    |
-----------------------------------------------------------------------------------------

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Stack                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Layer 1: Device Binding                                â”‚
â”‚  â”œâ”€â”€ ECDSA P-256 key pair per device                    â”‚
â”‚  â”œâ”€â”€ Private key never leaves device                    â”‚
â”‚  â””â”€â”€ Non-extractable WebCrypto keys                     â”‚
â”‚                                                         â”‚
â”‚  Layer 2: Request Signing                               â”‚
â”‚  â”œâ”€â”€ Timestamp prevents replay (5-min window)           â”‚
â”‚  â”œâ”€â”€ Nonce ensures uniqueness                           â”‚
â”‚  â””â”€â”€ Body hash ensures integrity                        â”‚
â”‚                                                         â”‚
â”‚  Layer 3: Server Verification                           â”‚
â”‚  â”œâ”€â”€ Signature verification before proxy                â”‚
â”‚  â”œâ”€â”€ Device status check (approved/suspended)           â”‚
â”‚  â””â”€â”€ Rate limiting per device                           â”‚
â”‚                                                         â”‚
â”‚  Layer 4: API Protection                                â”‚
â”‚  â”œâ”€â”€ JWT authentication for dashboard                   â”‚
â”‚  â”œâ”€â”€ IP whitelisting                                    â”‚
â”‚  â””â”€â”€ Comprehensive audit logging                        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚     â”‚   Device    â”‚     â”‚   ApiKey    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚     â”‚ id          â”‚     â”‚ id          â”‚
â”‚ email       â”‚â—„â”€â”€â”€â”€â”‚ userId      â”‚     â”‚ userId      â”‚
â”‚ password    â”‚     â”‚ publicKey   â”‚     â”‚ provider    â”‚
â”‚ name        â”‚     â”‚ keyId       â”‚     â”‚ encryptedKeyâ”‚
â”‚ role        â”‚     â”‚ fingerprint â”‚     â”‚ name        â”‚
â”‚ createdAt   â”‚     â”‚ label       â”‚     â”‚ isActive    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ status      â”‚     â”‚ createdAt   â”‚
                    â”‚ createdAt   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            
                          â”‚                    
                          â”‚                    
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  AuditLog   â”‚     â”‚  Settings   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ id          â”‚     â”‚ id          â”‚
                    â”‚ deviceId    â”‚     â”‚ key         â”‚
                    â”‚ action      â”‚     â”‚ value       â”‚
                    â”‚ resource    â”‚     â”‚ updatedAt   â”‚
                    â”‚ details     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ ipAddress   â”‚
                    â”‚ createdAt   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Architecture

      
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Production Setup                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   CDN       â”‚     â”‚      Load Balancer          â”‚    â”‚
â”‚  â”‚  (Vercel/   â”‚     â”‚      (nginx/AWS ALB)        â”‚    â”‚
â”‚  â”‚   Netlify)  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â”‚                   â”‚
â”‚         â”‚                           â”‚                   â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚         â”‚              â”‚            â”‚            â”‚      â”‚
â”‚         â–¼              â–¼            â–¼            â–¼      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Frontend  â”‚  â”‚ Backend  â”‚ â”‚ Backend  â”‚ â”‚ Backend  â”‚ â”‚
â”‚  â”‚  (Static)  â”‚  â”‚ Node 1   â”‚ â”‚ Node 2   â”‚ â”‚ Node 3   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚            â”‚            â”‚       â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                    â”‚                    â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                       â–¼            â–¼            â–¼       â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                 â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚ â”‚ Secrets  â”‚  â”‚
â”‚                 â”‚ (Primary)â”‚ â”‚ Cluster  â”‚ â”‚ Manager  â”‚  â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## Related Documentation

- [Security Protocol](./SECURITY_PROTOCOL.md) - Detailed cryptographic specifications
- [API Reference](./API_REFERENCE.md) - Complete endpoint documentation
- [Deployment Guide](./DEPLOYMENT.md) - Production deployment instructions
