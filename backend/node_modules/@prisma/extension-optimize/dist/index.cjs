"use strict";var xt=Object.create;var B=Object.defineProperty;var bt=Object.getOwnPropertyDescriptor;var It=Object.getOwnPropertyNames;var Tt=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty;var wt=(e,t)=>{for(var n in t)B(e,n,{get:t[n],enumerable:!0})},xe=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of It(t))!Rt.call(e,s)&&s!==n&&B(e,s,{get:()=>t[s],enumerable:!(r=bt(t,s))||r.enumerable});return e};var vt=(e,t,n)=>(n=e!=null?xt(Tt(e)):{},xe(t||!e||!e.__esModule?B(n,"default",{value:e,enumerable:!0}):n,e)),Et=e=>xe(B({},"__esModule",{value:!0}),e);var an={};wt(an,{PROD_DASHBOARD_URL:()=>ht,PROD_INGESTION_URL:()=>gt,withOptimize:()=>sn});module.exports=Et(an);var mt=require("@opentelemetry/api"),dt=require("@prisma/client/extension");var _=class{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,n){this.keyToValue.set(t,n),this.valueToKey.set(n,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}};var O=class{constructor(t){this.generateIdentifier=t,this.kv=new _}register(t,n){this.kv.getByValue(t)||(n||(n=this.generateIdentifier(t)),this.kv.set(n,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}};var N=class extends O{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,n){typeof n=="object"?(n.allowProps&&this.classToAllowedProps.set(t,n.allowProps),super.register(t,n.identifier)):super.register(t,n)}getAllowedProps(t){return this.classToAllowedProps.get(t)}};function Ot(e){if("values"in Object)return Object.values(e);let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function be(e,t){let n=Ot(e);if("find"in n)return n.find(t);let r=n;for(let s=0;s<r.length;s++){let i=r[s];if(t(i))return i}}function w(e,t){Object.entries(e).forEach(([n,r])=>t(r,n))}function P(e,t){return e.indexOf(t)!==-1}function Y(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(t(r))return r}}var V=class{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return be(this.transfomers,n=>n.isApplicable(t))}findByName(t){return this.transfomers[t]}};var Pt=e=>Object.prototype.toString.call(e).slice(8,-1),J=e=>typeof e>"u",At=e=>e===null,v=e=>typeof e!="object"||e===null||e===Object.prototype?!1:Object.getPrototypeOf(e)===null?!0:Object.getPrototypeOf(e)===Object.prototype,M=e=>v(e)&&Object.keys(e).length===0,g=e=>Array.isArray(e),qt=e=>typeof e=="string",Ct=e=>typeof e=="number"&&!isNaN(e),kt=e=>typeof e=="boolean",Ie=e=>e instanceof RegExp,b=e=>e instanceof Map,I=e=>e instanceof Set,ee=e=>Pt(e)==="Symbol",Te=e=>e instanceof Date&&!isNaN(e.valueOf()),Re=e=>e instanceof Error,te=e=>typeof e=="number"&&isNaN(e),we=e=>kt(e)||At(e)||J(e)||Ct(e)||qt(e)||ee(e),ve=e=>typeof e=="bigint",Ee=e=>e===1/0||e===-1/0,Oe=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),Pe=e=>e instanceof URL;var ne=e=>e.replace(/\./g,"\\."),F=e=>e.map(String).map(ne).join("."),A=e=>{let t=[],n="";for(let s=0;s<e.length;s++){let i=e.charAt(s);if(i==="\\"&&e.charAt(s+1)==="."){n+=".",s++;continue}if(i==="."){t.push(n),n="";continue}n+=i}let r=n;return t.push(r),t};function S(e,t,n,r){return{isApplicable:e,annotation:t,transform:n,untransform:r}}var Ae=[S(J,"undefined",()=>null,()=>{}),S(ve,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),S(Te,"Date",e=>e.toISOString(),e=>new Date(e)),S(Re,"Error",(e,t)=>{let n={name:e.name,message:e.message};return t.allowedErrorProps.forEach(r=>{n[r]=e[r]}),n},(e,t)=>{let n=new Error(e.message);return n.name=e.name,n.stack=e.stack,t.allowedErrorProps.forEach(r=>{n[r]=e[r]}),n}),S(Ie,"regexp",e=>""+e,e=>{let t=e.slice(1,e.lastIndexOf("/")),n=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,n)}),S(I,"set",e=>[...e.values()],e=>new Set(e)),S(b,"map",e=>[...e.entries()],e=>new Map(e)),S(e=>te(e)||Ee(e),"number",e=>te(e)?"NaN":e>0?"Infinity":"-Infinity",Number),S(e=>e===0&&1/e===-1/0,"number",()=>"-0",Number),S(Pe,"URL",e=>e.toString(),e=>new URL(e))];function U(e,t,n,r){return{isApplicable:e,annotation:t,transform:n,untransform:r}}var qe=U((e,t)=>ee(e)?!!t.symbolRegistry.getIdentifier(e):!1,(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,n)=>{let r=n.symbolRegistry.getValue(t[1]);if(!r)throw new Error("Trying to deserialize unknown symbol");return r}),jt=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),Ce=U(Oe,e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{let n=jt[t[1]];if(!n)throw new Error("Trying to deserialize unknown typed array");return new n(e)});function re(e,t){return e?.constructor?!!t.classRegistry.getIdentifier(e.constructor):!1}var ke=U(re,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{let n=t.classRegistry.getAllowedProps(e.constructor);if(!n)return{...e};let r={};return n.forEach(s=>{r[s]=e[s]}),r},(e,t,n)=>{let r=n.classRegistry.getValue(t[1]);if(!r)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(r.prototype),e)}),je=U((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,n)=>{let r=n.customTransformerRegistry.findByName(t[1]);if(!r)throw new Error("Trying to deserialize unknown custom value");return r.deserialize(e)}),zt=[ke,qe,je,Ce],se=(e,t)=>{let n=Y(zt,s=>s.isApplicable(e,t));if(n)return{value:n.transform(e,t),type:n.annotation(e,t)};let r=Y(Ae,s=>s.isApplicable(e,t));if(r)return{value:r.transform(e,t),type:r.annotation}},ze={};Ae.forEach(e=>{ze[e.annotation]=e});var Be=(e,t,n)=>{if(g(t))switch(t[0]){case"symbol":return qe.untransform(e,t,n);case"class":return ke.untransform(e,t,n);case"custom":return je.untransform(e,t,n);case"typed-array":return Ce.untransform(e,t,n);default:throw new Error("Unknown transformation: "+t)}else{let r=ze[t];if(!r)throw new Error("Unknown transformation: "+t);return r.untransform(e,n)}};var q=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");let n=e.keys();for(;t>0;)n.next(),t--;return n.next().value};function _e(e){if(P(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(P(e,"prototype"))throw new Error("prototype is not allowed as a property");if(P(e,"constructor"))throw new Error("constructor is not allowed as a property")}var Ne=(e,t)=>{_e(t);for(let n=0;n<t.length;n++){let r=t[n];if(I(e))e=q(e,+r);else if(b(e)){let s=+r,i=+t[++n]==0?"key":"value",a=q(e,s);switch(i){case"key":e=a;break;case"value":e=e.get(a);break}}else e=e[r]}return e},D=(e,t,n)=>{if(_e(t),t.length===0)return n(e);let r=e;for(let i=0;i<t.length-1;i++){let a=t[i];if(g(r)){let p=+a;r=r[p]}else if(v(r))r=r[a];else if(I(r)){let p=+a;r=q(r,p)}else if(b(r)){if(i===t.length-2)break;let l=+a,y=+t[++i]==0?"key":"value",d=q(r,l);switch(y){case"key":r=d;break;case"value":r=r.get(d);break}}}let s=t[t.length-1];if(g(r)?r[+s]=n(r[+s]):v(r)&&(r[s]=n(r[s])),I(r)){let i=q(r,+s),a=n(i);i!==a&&(r.delete(i),r.add(a))}if(b(r)){let i=+t[t.length-2],a=q(r,i);switch(+s==0?"key":"value"){case"key":{let l=n(a);r.set(l,r.get(a)),l!==a&&r.delete(a);break}case"value":{r.set(a,n(r.get(a)));break}}}return e};function ie(e,t,n=[]){if(!e)return;if(!g(e)){w(e,(i,a)=>ie(i,t,[...n,...A(a)]));return}let[r,s]=e;s&&w(s,(i,a)=>{ie(i,t,[...n,...A(a)])}),t(r,n)}function Ve(e,t,n){return ie(t,(r,s)=>{e=D(e,s,i=>Be(i,r,n))}),e}function Me(e,t){function n(r,s){let i=Ne(e,A(s));r.map(A).forEach(a=>{e=D(e,a,()=>i)})}if(g(t)){let[r,s]=t;r.forEach(i=>{e=D(e,A(i),()=>e)}),s&&w(s,n)}else w(t,n);return e}var Bt=(e,t)=>v(e)||g(e)||b(e)||I(e)||re(e,t);function _t(e,t,n){let r=n.get(e);r?r.push(t):n.set(e,[t])}function Fe(e,t){let n={},r;return e.forEach(s=>{if(s.length<=1)return;t||(s=s.map(p=>p.map(String)).sort((p,l)=>p.length-l.length));let[i,...a]=s;i.length===0?r=a.map(F):n[F(i)]=a.map(F)}),r?M(n)?[r]:[r,n]:M(n)?void 0:n}var oe=(e,t,n,r,s=[],i=[],a=new Map)=>{let p=we(e);if(!p){_t(e,s,t);let h=a.get(e);if(h)return r?{transformedValue:null}:h}if(!Bt(e,n)){let h=se(e,n),f=h?{transformedValue:h.value,annotations:[h.type]}:{transformedValue:e};return p||a.set(e,f),f}if(P(i,e))return{transformedValue:null};let l=se(e,n),y=l?.value??e,d=g(y)?[]:{},R={};w(y,(h,f)=>{if(f==="__proto__"||f==="constructor"||f==="prototype")throw new Error(`Detected property ${f}. This is a prototype pollution risk, please remove it from your object.`);let x=oe(h,t,n,r,[...s,f],[...i,e],a);d[f]=x.transformedValue,g(x.annotations)?R[f]=x.annotations:v(x.annotations)&&w(x.annotations,(G,Z)=>{R[ne(f)+"."+Z]=G})});let z=M(R)?{transformedValue:d,annotations:l?[l.type]:void 0}:{transformedValue:d,annotations:l?[l.type,R]:R};return p||a.set(e,z),z};function L(e){return Object.prototype.toString.call(e).slice(8,-1)}function ae(e){return L(e)==="Array"}function Ue(e){if(L(e)!=="Object")return!1;let t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}function Nt(e){return L(e)==="Null"}function Vt(e,t,n,r,s){return i=>e(i)||t(i)||!!n&&n(i)||!!r&&r(i)||!!s&&s(i)}function Mt(e){return L(e)==="Undefined"}var Dn=Vt(Nt,Mt);function Ft(e,t,n,r,s){let i={}.propertyIsEnumerable.call(r,t)?"enumerable":"nonenumerable";i==="enumerable"&&(e[t]=n),s&&i==="nonenumerable"&&Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0,configurable:!0})}function $(e,t={}){if(ae(e))return e.map(s=>$(s,t));if(!Ue(e))return e;let n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertySymbols(e);return[...n,...r].reduce((s,i)=>{if(ae(t.props)&&!t.props.includes(i))return s;let a=e[i],p=$(a,t);return Ft(s,i,p,e,t.nonenumerable),s},{})}var c=class{constructor({dedupe:t=!1}={}){this.classRegistry=new N,this.symbolRegistry=new O(n=>n.description??""),this.customTransformerRegistry=new V,this.allowedErrorProps=[],this.dedupe=t}serialize(t){let n=new Map,r=oe(t,n,this,this.dedupe),s={json:r.transformedValue};r.annotations&&(s.meta={...s.meta,values:r.annotations});let i=Fe(n,this.dedupe);return i&&(s.meta={...s.meta,referentialEqualities:i}),s}deserialize(t){let{json:n,meta:r}=t,s=$(n);return r?.values&&(s=Ve(s,r.values,this)),r?.referentialEqualities&&(s=Me(s,r.referentialEqualities)),s}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,n){this.classRegistry.register(t,n)}registerSymbol(t,n){this.symbolRegistry.register(t,n)}registerCustom(t,n){this.customTransformerRegistry.register({name:n,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}};c.defaultInstance=new c;c.serialize=c.defaultInstance.serialize.bind(c.defaultInstance);c.deserialize=c.defaultInstance.deserialize.bind(c.defaultInstance);c.stringify=c.defaultInstance.stringify.bind(c.defaultInstance);c.parse=c.defaultInstance.parse.bind(c.defaultInstance);c.registerClass=c.defaultInstance.registerClass.bind(c.defaultInstance);c.registerSymbol=c.defaultInstance.registerSymbol.bind(c.defaultInstance);c.registerCustom=c.defaultInstance.registerCustom.bind(c.defaultInstance);c.allowErrorProps=c.defaultInstance.allowErrorProps.bind(c.defaultInstance);var Jn=c.serialize,Ut=c.deserialize,De=c.stringify,er=c.parse,tr=c.registerClass,Le=c.registerCustom,nr=c.registerSymbol,rr=c.allowErrorProps;var He=!1;function Dt(e){Le({isApplicable:t=>(e?.isBuffer?.(t)??(typeof Buffer<"u"&&Buffer.isBuffer(t)))||$e(t),serialize:t=>$e(t)?t.data:[...t],deserialize:t=>e?.from?.(t)??(typeof Buffer<"u"?Buffer.from(t):{type:"Buffer",data:t})},"buffer"),He=!0}function $e(e){return typeof e=="object"&&e!==null&&Reflect.get(e,"type")==="Buffer"&&Array.isArray(Reflect.get(e,"data"))}var Ke=e=>typeof e=="string"?e:(He||Dt(),De(e));function Lt(e,t){let n;return async function(r,s,i){let a=new URL(r,e),p=new Headers({"Content-Type":"application/json",Authorization:`Bearer ${t}`});n&&p.set("prisma-optimize-jwt",n);let l=await fetch(a,{method:s,headers:p,body:Ke(i)});if(!l.ok){let d=await l.clone().text().catch(()=>"<unreadable>");console.error(`[optimize] HTTP ${l.status} ${l.statusText}: ${d}`)}let y=l.headers.get("prisma-optimize-jwt");return y&&(n=y),l}}function Qe(e,t){let n=Lt(e,t);return{request:n,post:(r,s)=>n(r,"POST",s)}}var We=vt(require("kleur"),1);var{bold:$t,underline:Ht}=We.default;function Ge(e){let t="See your Optimize dashboard at:",n=t.length,r=`${Ht($t(e))}`,s=e.length,i=Math.max(n,s)+2;console.log("\u250C"+"\u2500".repeat(i)+"\u2510"),console.log("\u2502 "+t+" ".repeat(i-n-2)+" \u2502"),console.log("\u2502 "+r+" ".repeat(i-s-2)+" \u2502"),console.log("\u2514"+"\u2500".repeat(i)+"\u2518")}var tt=require("@opentelemetry/api"),nt=require("@opentelemetry/context-async-hooks"),rt=require("@opentelemetry/instrumentation"),st=require("@opentelemetry/resources"),it=require("@opentelemetry/sdk-trace-base"),W=require("@opentelemetry/semantic-conventions"),he=require("prisma-instrumentation-5-x"),ot=require("prisma-instrumentation-6-x");async function Ze(e,t){t.length>0&&await e.post("/ingest",t)}async function Xe(e,t){return await(await e.post("/schema",t)).text()}function T(e){return e[0]*1e3+e[1]/1e6}var o=require("zod/v4");var E=require("zod/v4"),H=class{spans={};rootSpans={};waitSpans={};treeShape;collectedSpans;collectedRootSpans;sendTimeout;sendInterval;pendingSend;constructor(t){this.treeShape=t.treeShape,this.sendTimeout=t.sendTimeout,this.sendInterval=t.sendInterval,this.collectedSpans=t.collectedSpans,this.collectedRootSpans=t.collectedRootSpans,this.onEnd=Kt(()=>void this.forceFlush(),this.sendInterval)}onStart(t){let{parentSpanId:n,name:r}=t,{spanId:s}=t.spanContext();if(!this.collectedSpans.includes(r))return this.cleanSpan(this.spans[s]);if(this.spans[s]?.kind==="future"?Object.assign(this.spans[s],{kind:"present",value:t}):this.spans[s]={spanId:s,kind:"present",children:[],value:t,retries:0},this.collectedRootSpans.includes(r)){(n===void 0||this.rootSpans[n]===void 0)&&(this.rootSpans[s]={...this.spans[s],done:!1}),this.waitSpans[s]=this.spans[s];for(let{spanId:i}of this.spans[s].children)delete this.rootSpans[i]}n!==void 0&&(this.spans[n]?this.spans[n].children.push(this.spans[s]):(this.spans[n]={spanId:n,kind:"future",children:[this.spans[s]],retries:0},this.waitSpans[n]=this.spans[n]))}cleanSpan(t){if(t===void 0)return;let n=t.spanId;for(let r of t.children)this.cleanSpan(r);delete this.spans[n],delete this.rootSpans[n],delete this.waitSpans[n],this.onClean(t)}async forceFlush(){await this.pendingSend;let t=Object.values(this.rootSpans).flatMap(n=>{if(n.done)return[];if(process?.env?.__DEBUG_OPTIMIZE__){let s=(i,a="")=>{console.log(a,i.value.name,i.value.ended,i.value.attributes,i.spanId),i.children.forEach(p=>s(p,a+" ->"))};s(n)}let r=this.treeShape.safeParse(n);return r.data?(n.done=!0,[{original:n,pruned:r.data}]):[]});t.length>0&&(this.pendingSend=this.onFlush(t).finally(()=>{t.forEach(({original:n})=>this.cleanSpan(n))}));for(let n of Object.values(this.waitSpans))++n.retries*this.sendInterval>this.sendTimeout&&this.cleanSpan(n)}async shutdown(){await this.forceFlush(),this.spans={},this.rootSpans={},this.waitSpans={}}onEnd(){}};function Kt(e,t){let n=!1;return()=>{n===!1&&(n=!0,setTimeout(()=>(n=!1)||e(),t))}}var m={ended:E.z.literal(!0),_spanContext:E.z.custom(),spanContext:E.z.custom(),startTime:E.z.custom(),endTime:E.z.custom(),attributes:E.z.custom()};var pe=o.z.object({value:o.z.object({name:o.z.literal("prisma:engine:db_query"),...m})}),Qt=o.z.object({value:o.z.object({name:o.z.literal("prisma:engine:itx_execute_single"),...m}),children:C([pe])}),K=o.z.object({value:o.z.object({name:o.z.union([o.z.literal("prisma:engine"),o.z.literal("prisma:engine:query")]),...m}),children:C([pe])}),Wt=o.z.object({value:o.z.object({name:o.z.union([o.z.literal("prisma:engine"),o.z.literal("prisma:engine:query")]),...m}),children:C([o.z.union([Qt,pe])])}),ce=o.z.object({value:o.z.object({name:o.z.literal("prisma:client:connect"),...m})}),ue=o.z.object({value:o.z.object({name:o.z.literal("prisma:client:operation"),...m}),children:o.z.union([o.z.tuple([K]),o.z.tuple([ce,K]),o.z.tuple([K,ce])])}),Ye=o.z.object({value:o.z.object({name:o.z.literal("prisma:client:operation"),...m}),children:C([Wt])}),Gt=o.z.object({value:o.z.object({name:o.z.literal("prisma:engine:start_transaction"),...m})}),Zt=o.z.object({value:o.z.object({name:o.z.literal("prisma:engine:commit_transaction"),...m})}),le=o.z.object({value:o.z.object({name:o.z.literal("prisma:client:operation"),...m}),children:o.z.array(ce)}),fe=o.z.object({value:o.z.object({name:o.z.literal("prisma:client:transaction"),...m}),children:C([Gt,Zt])}),me=o.z.object({value:o.z.object({name:o.z.literal("prisma:client:transaction"),...m}),children:C([le,K])}),Je=o.z.union([ue,fe,me]);function C(e){return o.z.array(o.z.any()).nonempty().superRefine((t,n)=>{e.every(s=>t.some(i=>s.safeParse(i).success))||n.addIssue({code:"custom",message:"Array does not contain all the required items"})})}var Q=class extends H{requests={};errors={};schemaHash;resolvedSchemaHash;apiClient;schemaRequest;constructor(t){super({treeShape:Je,sendTimeout:t.sendTimeout,sendInterval:t.sendInterval,collectedSpans:["prisma:client:transaction","prisma:client:operation","prisma:client:connect","prisma:engine","prisma:engine:query","prisma:engine:db_query","prisma:engine:itx_execute_single","prisma:engine:start_transaction","prisma:engine:commit_transaction"],collectedRootSpans:["prisma:client:operation","prisma:client:transaction"]}),this.apiClient=t.apiClient,this.schemaRequest=t.schemaRequest}setRequest(t){this.requests[t.spanId]=t}setError(t){this.errors[t.spanId]=t}onClean({spanId:t}){delete this.requests[t],delete this.errors[t]}async onFlush(t){this.schemaHash??=Xe(this.apiClient,this.schemaRequest),this.resolvedSchemaHash??=await this.schemaHash;let n=t.flatMap(({pruned:r})=>Xt(r,this));await Ze(this.apiClient,n)}};function Xt(e,t){return fe.safeParse(e).success?Yt(e,t):me.safeParse(e).success?Jt(e,t):ue.safeParse(e).success?en(e,t):[]}function Yt(e,t){let n=[],r=e.children.filter(s=>Ye.safeParse(s).success);for(let s of r){if(ge({span:s,ip:t})===!1)continue;let i=nn(s);n.push(k({ip:t,span:s,sql:i,connect:!1}))}if(n.length){let s=de(e);n.unshift(k({ip:t,span:e,sql:null,connect:s}))}return n}function Jt(e,t){let n=[],r=e.children.filter(i=>le.safeParse(i).success),s=!1;for(let i of r)ge({span:i,ip:t})!==!1&&(s||=de(i),n.push(k({ip:t,span:i,sql:null,connect:!1})));return n.length&&n.unshift(k({ip:t,span:e,sql:null,connect:s})),n}function en(e,t){let n=de(e),r=tn(e);return ge({span:e,ip:t})===!1?[]:[k({ip:t,span:e,sql:r,connect:n})]}function k(e){let{span:t,sql:n,connect:r,ip:s}=e,i=t.value.spanContext().spanId,{value:a}=t;return{hash:s.resolvedSchemaHash,sql:n??null,connect:r??!1,error:s.errors[i]?.error??null,ts:T(a.startTime),model:s.requests[i]?.model??a.attributes.model??null,operation:s.requests[i]?.operation??a.attributes.method,args:s.requests[i]?.args??{},latency:T(a.endTime)-T(a.startTime)}}function et(e){return e.sort((n,r)=>T(n.value.startTime)-T(r.value.startTime)).reduce((n,r)=>{let s=r.value.attributes["db.statement"];return s??=r.value.attributes["db.query.text"],typeof s=="string"?`${n}${s}
`:n},"")}function tn(e){let{children:t}=e.children.find(({value:r})=>r.name==="prisma:engine"||r.name==="prisma:engine:query"),n=t.filter(({value:r})=>r.name==="prisma:engine:db_query");return et(n)}function nn(e){let{children:t}=e.children.find(({value:i})=>i.name==="prisma:engine"||i.name==="prisma:engine:query"),n=t.filter(({value:i})=>i.name==="prisma:engine:itx_execute_single"),s=(n.length?n:[{children:t}]).flatMap(({children:i})=>i.filter(({value:a})=>a.name==="prisma:engine:db_query"));return et(s)}function de(e){let{value:t}=e.children.find(({value:n})=>n.name==="prisma:client:connect")??{};return t?T(t.endTime)-T(t.startTime):!1}function ge(e){let{span:t,ip:n}=e;return!!n.requests[t.value.spanContext().spanId]}var j,rn={"5-x":he.PrismaInstrumentation,"6-x":ot.PrismaInstrumentation};function at(e){if(j)return j;let t=new nt.AsyncHooksContextManager().enable();tt.context.setGlobalContextManager(t);let n=new it.BasicTracerProvider({resource:new st.Resource({[W.SEMRESATTRS_SERVICE_NAME]:"extension-optimize",[W.SEMRESATTRS_SERVICE_VERSION]:"0.0.0"})});j=new Q(e),n.addSpanProcessor(j);let[r="5",s="0"]=e.clientVersion.split("."),i=rn[`${r}-x`];return(r==="6"&&s==="0"||i===void 0)&&(i=he.PrismaInstrumentation),(0,rt.registerInstrumentations)({tracerProvider:n,instrumentations:[new i]}),n.register(),j}function ct(e){let t=Reflect.get(e,"_clientVersion");return Number(t.split(".")[0]??"5")<6?e._previewFeatures?.includes("tracing"):!0}function pt(e){return e._engineConfig.inlineSchema}function ut(e){if(e instanceof Error)return e.stack??e.message;switch(typeof e){case"undefined":return"undefined";case"object":{let t;return e!==null&&typeof e.toString=="function"&&(t=e.toString()),typeof t=="string"&&t!=="[object Object]"?t:JSON.stringify(e)}default:return String(e)}}var lt=require("@prisma/client/extension"),ft=lt.Prisma.defineExtension(e=>e.$extends({}));var gt="https://optimize-ingestion.datacdn.workers.dev/",ht="https://optimize.prisma.io";function sn({enable:e=!0,ingestionUrl:t=gt,dashboardUrl:n=ht,sendInterval:r=500,sendTimeout:s=1e4,showNotification:i=!0,apiKey:a}){return e?(i&&Ge(n),dt.Prisma.defineExtension(p=>{let l=pt(p),y=Reflect.get(p,"_clientVersion"),d=Reflect.get(p,"_activeProvider"),R=Reflect.get(p,"_accelerateEngineConfig"),z=on(R,d),h={schema:l,provider:d,protocol:z},f=Qe(t,a),x=at({schemaRequest:h,apiClient:f,sendInterval:r,sendTimeout:s,clientVersion:y});if(!ct(p))throw new Error('Please enable the "tracing" preview feature and regenerate the client.');return p.$extends({query:{async $allOperations({query:G,model:Z,operation:St,args:Se}){let X=mt.trace.getActiveSpan()?.spanContext().spanId;if(!X)throw new Error("prisma:client:operation span is expected to be entered in the client extension when tracing is enabled");x.setRequest({spanId:X,model:Z,operation:St,args:Se});try{return await G(Se)}catch(ye){let yt=ut(ye);throw x.setError({spanId:X,error:yt}),ye}}}})})):ft}function on(e,t){try{let{protocol:n}=new URL(e.accelerateUtils.resolveDatasourceUrl(e));return n}catch{switch(t){case"sqlite":return"file:";case"postgresql":case"cockroachdb":return"postgres:";default:return`${t}:`}}}0&&(module.exports={PROD_DASHBOARD_URL,PROD_INGESTION_URL,withOptimize});
