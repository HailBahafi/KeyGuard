{"version":3,"sources":["../../../src/core/database/prisma.service.ts"],"sourcesContent":["import { isDevelopment } from '@/src/common/utils/is-environment.util';\nimport { Injectable, OnModuleDestroy, OnModuleInit } from '@nestjs/common';\nimport { withAccelerate } from '@prisma/extension-accelerate';\nimport { withOptimize } from '@prisma/extension-optimize';\nimport settings from 'src/common/config/index';\nimport { PrismaClient } from 'src/generated/client';\n\n@Injectable()\nexport class PrismaService implements OnModuleInit, OnModuleDestroy {\n  public readonly prisma: ReturnType<(typeof PrismaService)['createPrismaClient']>;\n\n  constructor() {\n    this.prisma = PrismaService.createPrismaClient();\n  }\n\n  private static createPrismaClient() {\n    const isDev = isDevelopment();\n\n    let client = new PrismaClient({\n      log: isDev ? ['query', 'info', 'warn', 'error'] : ['warn', 'error'],\n      errorFormat: 'pretty',\n      accelerateUrl: settings.DATABASE_URL,\n    });\n\n    const optimizeApiKey = settings.OPTIMIZE_API_KEY;\n    if (isDev && optimizeApiKey) {\n      type ClientType = typeof client;\n      client = client.$extends(withOptimize({ apiKey: optimizeApiKey })) as ClientType;\n    }\n\n    return client.$extends(withAccelerate());\n  }\n\n  async onModuleInit(): Promise<void> {\n    await this.prisma.$connect();\n  }\n\n  async onModuleDestroy() {\n    await this.prisma.$disconnect();\n  }\n}\n"],"names":["PrismaService","createPrismaClient","isDev","isDevelopment","client","PrismaClient","log","errorFormat","accelerateUrl","settings","DATABASE_URL","optimizeApiKey","OPTIMIZE_API_KEY","$extends","withOptimize","apiKey","withAccelerate","onModuleInit","prisma","$connect","onModuleDestroy","$disconnect"],"mappings":";;;;+BAQaA;;;eAAAA;;;mCARiB;wBAC4B;qCAC3B;mCACF;8DACR;wBACQ;;;;;;;;;;;;;;;AAGtB,IAAA,AAAMA,gBAAN,MAAMA;IAOX,OAAeC,qBAAqB;QAClC,MAAMC,QAAQC,IAAAA,gCAAa;QAE3B,IAAIC,SAAS,IAAIC,oBAAY,CAAC;YAC5BC,KAAKJ,QAAQ;gBAAC;gBAAS;gBAAQ;gBAAQ;aAAQ,GAAG;gBAAC;gBAAQ;aAAQ;YACnEK,aAAa;YACbC,eAAeC,cAAQ,CAACC,YAAY;QACtC;QAEA,MAAMC,iBAAiBF,cAAQ,CAACG,gBAAgB;QAChD,IAAIV,SAASS,gBAAgB;YAE3BP,SAASA,OAAOS,QAAQ,CAACC,IAAAA,+BAAY,EAAC;gBAAEC,QAAQJ;YAAe;QACjE;QAEA,OAAOP,OAAOS,QAAQ,CAACG,IAAAA,mCAAc;IACvC;IAEA,MAAMC,eAA8B;QAClC,MAAM,IAAI,CAACC,MAAM,CAACC,QAAQ;IAC5B;IAEA,MAAMC,kBAAkB;QACtB,MAAM,IAAI,CAACF,MAAM,CAACG,WAAW;IAC/B;IA5BA,aAAc;QACZ,IAAI,CAACH,MAAM,GAAGlB,cAAcC,kBAAkB;IAChD;AA2BF"}