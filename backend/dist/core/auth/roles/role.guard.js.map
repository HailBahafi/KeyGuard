{"version":3,"sources":["../../../../src/core/auth/roles/role.guard.ts"],"sourcesContent":["// src/common/guards/roles.guard.ts\nimport {\n    CanActivate,\n    ExecutionContext,\n    ForbiddenException,\n    Injectable\n} from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { ROLES_KEY } from 'src/common/decorators/roles.decorator';\nimport { UserRole } from 'src/generated/enums';\n\n@Injectable()\nexport class RolesGuard implements CanActivate {\n    constructor(private reflector: Reflector) { }\n    canActivate(context: ExecutionContext): boolean {\n        const requiredRoles = this.reflector.getAllAndOverride<UserRole[]>(ROLES_KEY, [\n            context.getHandler(),\n            context.getClass(),\n        ]);\n        if (!requiredRoles || requiredRoles.length === 0) return true;\n        const { user } = context.switchToHttp().getRequest();\n        if (!user || !requiredRoles.includes(user.role)) {\n            throw new ForbiddenException('You do not have access to this resource');\n        }\n        return true;\n    }\n}\n"],"names":["RolesGuard","canActivate","context","requiredRoles","reflector","getAllAndOverride","ROLES_KEY","getHandler","getClass","length","user","switchToHttp","getRequest","includes","role","ForbiddenException"],"mappings":"AAAA,mCAAmC;;;;;+BAYtBA;;;eAAAA;;;wBANN;sBACmB;gCACA;;;;;;;;;;AAInB,IAAA,AAAMA,aAAN,MAAMA;IAETC,YAAYC,OAAyB,EAAW;QAC5C,MAAMC,gBAAgB,IAAI,CAACC,SAAS,CAACC,iBAAiB,CAAaC,yBAAS,EAAE;YAC1EJ,QAAQK,UAAU;YAClBL,QAAQM,QAAQ;SACnB;QACD,IAAI,CAACL,iBAAiBA,cAAcM,MAAM,KAAK,GAAG,OAAO;QACzD,MAAM,EAAEC,IAAI,EAAE,GAAGR,QAAQS,YAAY,GAAGC,UAAU;QAClD,IAAI,CAACF,QAAQ,CAACP,cAAcU,QAAQ,CAACH,KAAKI,IAAI,GAAG;YAC7C,MAAM,IAAIC,0BAAkB,CAAC;QACjC;QACA,OAAO;IACX;IAZA,YAAY,AAAQX,SAAoB,CAAE;aAAtBA,YAAAA;IAAwB;AAahD"}