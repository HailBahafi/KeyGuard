{"version":3,"sources":["../../../../src/core/auth/permissions/permission.guard.ts"],"sourcesContent":["import { CanActivate, ExecutionContext, Injectable } from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { PERMISSIONS_KEY } from 'src/common/decorators/permission.decorator';\nimport { Permission } from './permission.enum';\n\n@Injectable()\nexport class PermissionsGuard implements CanActivate {\n  constructor(private reflector: Reflector) {}\n\n  canActivate(context: ExecutionContext): boolean {\n    const requiredPermissions = this.reflector.getAllAndOverride<Permission[]>(\n      PERMISSIONS_KEY,\n      [context.getHandler(), context.getClass()],\n    );\n    if (!requiredPermissions) {\n      return true;\n    }\n    const { user } = context.switchToHttp().getRequest();\n    return requiredPermissions.some((permission: any) =>\n      user?.permissions?.some((p: any) => p?.name === permission),\n    );\n  }\n}\n"],"names":["PermissionsGuard","canActivate","context","requiredPermissions","reflector","getAllAndOverride","PERMISSIONS_KEY","getHandler","getClass","user","switchToHttp","getRequest","some","permission","permissions","p","name"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBAN6C;sBAChC;qCACM;;;;;;;;;;AAIzB,IAAA,AAAMA,mBAAN,MAAMA;IAGXC,YAAYC,OAAyB,EAAW;QAC9C,MAAMC,sBAAsB,IAAI,CAACC,SAAS,CAACC,iBAAiB,CAC1DC,oCAAe,EACf;YAACJ,QAAQK,UAAU;YAAIL,QAAQM,QAAQ;SAAG;QAE5C,IAAI,CAACL,qBAAqB;YACxB,OAAO;QACT;QACA,MAAM,EAAEM,IAAI,EAAE,GAAGP,QAAQQ,YAAY,GAAGC,UAAU;QAClD,OAAOR,oBAAoBS,IAAI,CAAC,CAACC,aAC/BJ,MAAMK,aAAaF,KAAK,CAACG,IAAWA,GAAGC,SAASH;IAEpD;IAdA,YAAY,AAAQT,SAAoB,CAAE;aAAtBA,YAAAA;IAAuB;AAe7C"}