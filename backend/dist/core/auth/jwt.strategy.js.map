{"version":3,"sources":["../../../src/core/auth/jwt.strategy.ts"],"sourcesContent":["import { Injectable, UnauthorizedException } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\nimport { PrismaService } from '../database/prisma.service';\nimport { User } from '@/generated/client';\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n  constructor(\n    private readonly prismaService: PrismaService,\n    private readonly configService: ConfigService,\n  ) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      ignoreExpiration: false,\n      secretOrKey: configService.get<string>('JWT_SECRET_KEY')!,\n    });\n  }\n  async validate(payload: any): Promise<User> {\n    const user = await this.prismaService.prisma.user.findUnique({\n      cacheStrategy: {\n        ttl: 60, // Cache for 1 minute\n      },\n      where: { id: payload?.id },\n      omit: { password: false },\n    });\n    if (!user) {\n      throw new UnauthorizedException();\n    }\n    if (!user.isActive) {\n      throw new UnauthorizedException('User blocked');\n    }\n    return user;\n  }\n}\n"],"names":["JwtStrategy","PassportStrategy","Strategy","validate","payload","user","prismaService","prisma","findUnique","cacheStrategy","ttl","where","id","omit","password","UnauthorizedException","isActive","configService","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","ignoreExpiration","secretOrKey","get"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPqC;wBACpB;0BACG;6BACI;+BACP;;;;;;;;;;AAGvB,IAAA,AAAMA,cAAN,MAAMA,oBAAoBC,IAAAA,0BAAgB,EAACC,qBAAQ;IAWxD,MAAMC,SAASC,OAAY,EAAiB;QAC1C,MAAMC,OAAO,MAAM,IAAI,CAACC,aAAa,CAACC,MAAM,CAACF,IAAI,CAACG,UAAU,CAAC;YAC3DC,eAAe;gBACbC,KAAK;YACP;YACAC,OAAO;gBAAEC,IAAIR,SAASQ;YAAG;YACzBC,MAAM;gBAAEC,UAAU;YAAM;QAC1B;QACA,IAAI,CAACT,MAAM;YACT,MAAM,IAAIU,6BAAqB;QACjC;QACA,IAAI,CAACV,KAAKW,QAAQ,EAAE;YAClB,MAAM,IAAID,6BAAqB,CAAC;QAClC;QACA,OAAOV;IACT;IAzBA,YACE,AAAiBC,aAA4B,EAC7C,AAAiBW,aAA4B,CAC7C;QACA,KAAK,CAAC;YACJC,gBAAgBC,uBAAU,CAACC,2BAA2B;YACtDC,kBAAkB;YAClBC,aAAaL,cAAcM,GAAG,CAAS;QACzC,SAPiBjB,gBAAAA,oBACAW,gBAAAA;IAOnB;AAiBF"}