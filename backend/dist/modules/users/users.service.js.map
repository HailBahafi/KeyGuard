{"version":3,"sources":["../../../src/modules/users/users.service.ts"],"sourcesContent":["import { BadRequestException, Injectable } from '@nestjs/common';\nimport { CurrentUserType } from 'src/common/decorators/current-user.decorator';\nimport { Hashing } from 'src/common/utils/hashing.util';\nimport { PrismaService } from 'src/core/database/prisma.service';\nimport { QueryUserDto } from './dto/query-user.dto';\nimport { UpdateProfileDto } from './dto/update-profile.dto';\n@Injectable()\nexport class UsersService {\n  constructor(private readonly prismaService: PrismaService) {}\n  async findAll(query: QueryUserDto) {\n    return await this.prismaService.prisma.user.findMany({\n      skip: (query.offset - 1) * query.limit,\n      take: query.limit,\n    });\n  }\n  findProfile(user: CurrentUserType) {\n    const { password, ...data } = user;\n    return data;\n  }\n  async updateProfile(user: CurrentUserType, updateProfileDto: UpdateProfileDto) {\n    const { oldPassword, newPassword, ...rest } = updateProfileDto;\n    const userExist = await this.prismaService.prisma.user.findFirst({\n      where: {\n        OR: [{ email: updateProfileDto.email }, { username: updateProfileDto.username }],\n      },\n    });\n    if (userExist && userExist.id !== user.id)\n      throw new BadRequestException('email or username already exists');\n    const data: any = { ...rest };\n    if (oldPassword && newPassword) {\n      await Hashing.compareOrFail(oldPassword, user.password, 'password is not correct');\n      const hashedPassword = await Hashing.hash(newPassword);\n      data.password = hashedPassword;\n    }\n    const updatedUser = await this.prismaService.prisma.user.update({\n      where: { id: user.id },\n      data: { ...data },\n    });\n    return updatedUser;\n  }\n}\n"],"names":["UsersService","findAll","query","prismaService","prisma","user","findMany","skip","offset","limit","take","findProfile","password","data","updateProfile","updateProfileDto","oldPassword","newPassword","rest","userExist","findFirst","where","OR","email","username","id","BadRequestException","Hashing","compareOrFail","hashedPassword","hash","updatedUser","update"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPmC;6BAExB;+BACM;;;;;;;;;;AAIvB,IAAA,AAAMA,eAAN,MAAMA;IAEX,MAAMC,QAAQC,KAAmB,EAAE;QACjC,OAAO,MAAM,IAAI,CAACC,aAAa,CAACC,MAAM,CAACC,IAAI,CAACC,QAAQ,CAAC;YACnDC,MAAM,AAACL,CAAAA,MAAMM,MAAM,GAAG,CAAA,IAAKN,MAAMO,KAAK;YACtCC,MAAMR,MAAMO,KAAK;QACnB;IACF;IACAE,YAAYN,IAAqB,EAAE;QACjC,MAAM,EAAEO,QAAQ,EAAE,GAAGC,MAAM,GAAGR;QAC9B,OAAOQ;IACT;IACA,MAAMC,cAAcT,IAAqB,EAAEU,gBAAkC,EAAE;QAC7E,MAAM,EAAEC,WAAW,EAAEC,WAAW,EAAE,GAAGC,MAAM,GAAGH;QAC9C,MAAMI,YAAY,MAAM,IAAI,CAAChB,aAAa,CAACC,MAAM,CAACC,IAAI,CAACe,SAAS,CAAC;YAC/DC,OAAO;gBACLC,IAAI;oBAAC;wBAAEC,OAAOR,iBAAiBQ,KAAK;oBAAC;oBAAG;wBAAEC,UAAUT,iBAAiBS,QAAQ;oBAAC;iBAAE;YAClF;QACF;QACA,IAAIL,aAAaA,UAAUM,EAAE,KAAKpB,KAAKoB,EAAE,EACvC,MAAM,IAAIC,2BAAmB,CAAC;QAChC,MAAMb,OAAY;YAAE,GAAGK,IAAI;QAAC;QAC5B,IAAIF,eAAeC,aAAa;YAC9B,MAAMU,oBAAO,CAACC,aAAa,CAACZ,aAAaX,KAAKO,QAAQ,EAAE;YACxD,MAAMiB,iBAAiB,MAAMF,oBAAO,CAACG,IAAI,CAACb;YAC1CJ,KAAKD,QAAQ,GAAGiB;QAClB;QACA,MAAME,cAAc,MAAM,IAAI,CAAC5B,aAAa,CAACC,MAAM,CAACC,IAAI,CAAC2B,MAAM,CAAC;YAC9DX,OAAO;gBAAEI,IAAIpB,KAAKoB,EAAE;YAAC;YACrBZ,MAAM;gBAAE,GAAGA,IAAI;YAAC;QAClB;QACA,OAAOkB;IACT;IA/BA,YAAY,AAAiB5B,aAA4B,CAAE;aAA9BA,gBAAAA;IAA+B;AAgC9D"}