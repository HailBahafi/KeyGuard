{"version":3,"sources":["../../../src/common/logger/logger.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport dayjs from 'dayjs';\nimport { promises as fs } from 'fs';\nimport { join } from 'path';\nimport * as winston from 'winston';\nimport { PaginationDto } from '../base/pagination.dto';\n@Injectable()\nexport class LoggerService {\n  private logger: winston.Logger;\n  constructor() {\n    this.logger = winston.createLogger({\n      transports: [new winston.transports.Console()],\n    });\n  }\n  private readonly logFilePath = join(__dirname, '../../../logs/error.log');\n  async findAll(query: PaginationDto) {\n    // Read the log file\n    const data = await fs.readFile(this.logFilePath, 'utf-8');\n    const entries = data\n      .split('\\n')\n      .filter(Boolean)\n      .map((line) => JSON.parse(line))\n      .sort((a, b) => dayjs(b.timestamp).diff(dayjs(a.timestamp)));\n    const totalEntries = entries.length;\n    const totalPages = Math.ceil(totalEntries / query.limit);\n    const startIndex = (query.offset - 1) * query.limit;\n    const paginatedData = entries.slice(startIndex, startIndex + query.limit);\n    return {\n      data: paginatedData,\n      total: totalEntries,\n      page: query.offset,\n      pageSize: query.limit,\n      totalPages,\n    };\n  }\n  log(message: string) {\n    this.logger.info(message);\n  }\n}\n"],"names":["LoggerService","findAll","query","data","fs","readFile","logFilePath","entries","split","filter","Boolean","map","line","JSON","parse","sort","a","b","dayjs","timestamp","diff","totalEntries","length","totalPages","Math","ceil","limit","startIndex","offset","paginatedData","slice","total","page","pageSize","log","message","logger","info","join","__dirname","winston","createLogger","transports","Console"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPc;8DACT;oBACa;sBACV;iEACI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGlB,IAAA,AAAMA,gBAAN,MAAMA;IAQX,MAAMC,QAAQC,KAAoB,EAAE;QAClC,oBAAoB;QACpB,MAAMC,OAAO,MAAMC,YAAE,CAACC,QAAQ,CAAC,IAAI,CAACC,WAAW,EAAE;QACjD,MAAMC,UAAUJ,KACbK,KAAK,CAAC,MACNC,MAAM,CAACC,SACPC,GAAG,CAAC,CAACC,OAASC,KAAKC,KAAK,CAACF,OACzBG,IAAI,CAAC,CAACC,GAAGC,IAAMC,IAAAA,cAAK,EAACD,EAAEE,SAAS,EAAEC,IAAI,CAACF,IAAAA,cAAK,EAACF,EAAEG,SAAS;QAC3D,MAAME,eAAed,QAAQe,MAAM;QACnC,MAAMC,aAAaC,KAAKC,IAAI,CAACJ,eAAenB,MAAMwB,KAAK;QACvD,MAAMC,aAAa,AAACzB,CAAAA,MAAM0B,MAAM,GAAG,CAAA,IAAK1B,MAAMwB,KAAK;QACnD,MAAMG,gBAAgBtB,QAAQuB,KAAK,CAACH,YAAYA,aAAazB,MAAMwB,KAAK;QACxE,OAAO;YACLvB,MAAM0B;YACNE,OAAOV;YACPW,MAAM9B,MAAM0B,MAAM;YAClBK,UAAU/B,MAAMwB,KAAK;YACrBH;QACF;IACF;IACAW,IAAIC,OAAe,EAAE;QACnB,IAAI,CAACC,MAAM,CAACC,IAAI,CAACF;IACnB;IA5BA,aAAc;aAKG7B,cAAcgC,IAAAA,UAAI,EAACC,WAAW;QAJ7C,IAAI,CAACH,MAAM,GAAGI,SAAQC,YAAY,CAAC;YACjCC,YAAY;gBAAC,IAAIF,SAAQE,UAAU,CAACC,OAAO;aAAG;QAChD;IACF;AAyBF"}